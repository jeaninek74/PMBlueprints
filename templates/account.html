{% extends "base.html" %}

{% block title %}My Account - PMBlueprints{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">My Account</h1>
    
    <!-- Account Information -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Profile Information -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Profile Information</h2>
            <div class="space-y-3">
                <div>
                    <label class="text-sm text-gray-600">Email</label>
                    <p class="font-medium">{{ user.email }}</p>
                </div>
                <div>
                    <label class="text-sm text-gray-600">Name</label>
                    <p class="font-medium">{{ user.name or 'Not set' }}</p>
                </div>
                <div>
                    <label class="text-sm text-gray-600">Company</label>
                    <p class="font-medium">{{ user.company or 'Not set' }}</p>
                </div>
                <div>
                    <label class="text-sm text-gray-600">Member Since</label>
                    <p class="font-medium">{{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'Unknown' }}</p>
                </div>
            </div>
        </div>
        
        <!-- Subscription Information -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Subscription</h2>
            <div class="space-y-3">
                <div>
                    <label class="text-sm text-gray-600">Current Plan</label>
                    <p class="font-medium text-lg">{{ subscription.tier_name }}</p>
                </div>
                <div>
                    <label class="text-sm text-gray-600">Price</label>
                    <p class="font-medium">
                        {% if subscription.price == 0 %}
                            Free
                        {% else %}
                            ${{ "%.2f"|format(subscription.price / 100) }}
                            {% if subscription.tier == 'individual' %}
                                (one-time)
                            {% else %}
                                /month
                            {% endif %}
                        {% endif %}
                    </p>
                </div>
                <div>
                    <label class="text-sm text-gray-600">Status</label>
                    <p class="font-medium">
                        <span class="px-2 py-1 rounded text-sm {% if subscription.is_active %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ 'Active' if subscription.is_active else 'Inactive' }}
                        </span>
                    </p>
                </div>
                {% if subscription.tier != 'enterprise' %}
                <div class="mt-4">
                    <a href="/pricing" class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        Upgrade Plan
                    </a>
                </div>
                {% endif %}
                {% if subscription.can_cancel %}
                <div class="mt-2">
                    <button onclick="cancelSubscription()" class="text-red-600 hover:text-red-800 text-sm">
                        Cancel Subscription
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Usage Statistics -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">Usage This Month</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Downloads -->
            <div>
                <h3 class="text-sm text-gray-600 mb-2">Template Downloads</h3>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-2xl font-bold">{{ usage.downloads.used }}</span>
                    <span class="text-gray-600">/ {{ usage.downloads.limit }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full" style="width: {% if usage.downloads.limit > 0 %}{{ (usage.downloads.used / usage.downloads.limit * 100)|int }}{% else %}0{% endif %}%"></div>
                </div>
                <p class="text-sm text-gray-600 mt-1">{{ usage.downloads.remaining }} remaining</p>
            </div>
            
            <!-- AI Suggestions -->
            <div>
                <h3 class="text-sm text-gray-600 mb-2">AI Suggestions</h3>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-2xl font-bold">{{ usage.ai_suggestions.used }}</span>
                    <span class="text-gray-600">/ {{ usage.ai_suggestions.limit }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-green-600 h-2 rounded-full" style="width: {% if usage.ai_suggestions.limit > 0 %}{{ (usage.ai_suggestions.used / usage.ai_suggestions.limit * 100)|int }}{% else %}0{% endif %}%"></div>
                </div>
                <p class="text-sm text-gray-600 mt-1">{{ usage.ai_suggestions.remaining }} remaining</p>
            </div>
            
            <!-- AI Generations -->
            <div>
                <h3 class="text-sm text-gray-600 mb-2">AI Generations</h3>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-2xl font-bold">{{ usage.ai_generations.used }}</span>
                    <span class="text-gray-600">/ {{ usage.ai_generations.limit }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-purple-600 h-2 rounded-full" style="width: {% if usage.ai_generations.limit > 0 %}{{ (usage.ai_generations.used / usage.ai_generations.limit * 100)|int }}{% else %}0{% endif %}%"></div>
                </div>
                <p class="text-sm text-gray-600 mt-1">{{ usage.ai_generations.remaining }} remaining</p>
            </div>
        </div>
    </div>
    
    <!-- Features Available -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">Available Features</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>Browse all templates</span>
            </div>
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>View template details</span>
            </div>
            {% if usage.downloads.limit > 0 %}
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>Download templates ({{ usage.downloads.limit }}/month)</span>
            </div>
            {% endif %}
            {% if usage.ai_generations.limit > 0 %}
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>AI Generator ({{ usage.ai_generations.limit }}/month)</span>
            </div>
            {% endif %}
            {% if usage.ai_suggestions.limit > 0 %}
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>AI Suggestions ({{ usage.ai_suggestions.limit }}/month)</span>
            </div>
            {% endif %}
            {% if usage.platform_integrations %}
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>Platform Integrations</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function cancelSubscription() {
    if (confirm('Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your billing period.')) {
        fetch('/account/cancel', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Subscription cancelled successfully');
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to cancel subscription');
        });
    }
}
</script>
{% endblock %}

